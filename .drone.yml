kind: pipeline
name: default
type: kubernetes

services:
- name: redis
  image: redis

steps:
- name: agent_1
  image: ruby:3.0
  commands: 
    - bundle install
    - gem install knapsack
    - CI_NODE_TOTAL=2 CI_NODE_INDEX=0 knapsack rspec
- name: agent_2
  image: ruby:3.0
  commands: 
    - bundle install
    - gem install knapsack
    - CI_NODE_TOTAL=2 CI_NODE_INDEX=1 knapsack rspec
- name: data
  image: ruby:3.0
  commands: 
    - cat result.json
  depends_on: 
    - agent_1
    - agent_2